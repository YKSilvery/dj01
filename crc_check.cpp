#include "src/aim_auto/include/aim_auto/serial_protocol.hpp"
#include <array>
#include <cstring>
#include <iostream>

int main() {
  std::array<std::uint8_t, 61> data = {
    0x71, 0x00, 0x00, 0x00, 0x3f, 0xcd, 0xcc, 0xcc,
    0x3d, 0x05, 0x01, 0x00, 0x00, 0x00, 0x20, 0x41,
    0x00, 0x00, 0x00, 0x40, 0xcd, 0xcc, 0xcc, 0x3d,
    0x00, 0x00, 0x00, 0x3f, 0xcd, 0xcc, 0x4c, 0x3d,
    0x00, 0x00, 0x80, 0x3f, 0x00, 0x00, 0x80, 0x3f,
    0x00, 0x00, 0x20, 0x40, 0x00, 0x00, 0x20, 0x40,
    0xcd, 0xcc, 0x4c, 0x3e, 0x0a, 0xd7, 0x23, 0x3c,
    0x3e, 0x66, 0x4c, 0x00, 0x00
  };
  aim_auto::MessData msg{};
  std::memcpy(&msg, data.data(), data.size());
  auto crc_including = aim_auto::crc16(reinterpret_cast<const std::uint8_t*>(&msg), data.size());
  std::cout << "CRC with stored bytes: 0x" << std::hex << crc_including << std::endl;
  aim_auto::MessData msg_zero = msg;
  msg_zero.crc = 0;
  auto crc_zeroed = aim_auto::crc16(reinterpret_cast<const std::uint8_t*>(&msg_zero), data.size());
  std::cout << "CRC after zeroing field: 0x" << std::hex << crc_zeroed << std::endl;
  std::cout << "verifyCrc result: " << std::boolalpha << aim_auto::verifyCrc(msg) << std::endl;
  return 0;
}
